# Bitrix-img2picture-modile


Модуль для оптимизации изображений на сайте.

В результате в зависимости от разрешения экрана и возможностей браузера будет загружаться соответствующая картинка.

Есть возможность настроить, чтобы для мобилных устройств загружалось уменьшенное изображение, а для десктопных полноразмерная, что экономиит трафик. (все это настраивается)

И если браузер умеет (а сейчас почти все умеют) показывать webp, по будет загружено изображение в формате webp.

Несколько режимов работы модуля:

- Выключен - когда разработчик сам управляет и просто использует где ему необходимо функции модуля,
- Тестирование - собственно для тестирования работы модуля и отладки шаблона замены
- Включен - модуль ищет и заменяет теги img в соответсвии с настройками модуля.

# Как это работает


Модуль заменяет теги img на теги picture с ресайзом и конвертацией изображений.

Модуль так-же заменяет background с ресайзом и конвертацией изображений.

Модуль не работает если текущий пользователь адмиристратор - для того чтобы не заменять теги во время редактирования контента.

Модуль не работает в администаривной части сайта.

Т.е. тестирование работы модуля надо проводить НЕ авторизованным пользователем в режиме "тестирование".


# В режиме "Тестирование":


включить модуль дописав get параметр ?img2picture=on

выключить модуль дописав get параметр ?img2picture=off

лог пишется в стандартный файл битрикса (по умолчанию /__bx_log.log)

------
# После установки модуля доступны следующие функции:

	IS_PRO\img2picture\doIt(string $content, array $option = [])

вернет контент с замененными img на picture

$content - контент в котором необходимо заменить все img

$option - необязательный массив параметров замены

---

	IS_PRO\img2picture\MakeWebp(string $src, array $option = [])

вернет ссылку на созданный webp

в случае не удачи вернет false

$src - ссылка на изображение

$option - необязательный массив
параметров замены

---

	IS_PRO\img2picture\GetOptions()

вернет параметры модуля

# Доступные события модуля:
Можно перехватить и кастомизировать замену

	/* Для перехвата замены img */
	AddEventHandler("is_pro.img2picture", "OnPrepareResultImg", "MyPicture");

	function MyPicture(&$arResult)
	{
		/* Какой-то код меняющий $arResult */
	}

	/* Для перехвата замены backgropunds */
	AddEventHandler("is_pro.img2picture", "OnPrepareResultBackground", "MyBackground");

	function MyBackground(&$arResult)
	{
		/* Какой-то код меняющий $arResult */
	}

# Поблагодарить

Можно пройдя по ссылке https://www.sberbank.com/ru/person/dl/jc?linkname=jGTzsJPtWFkAxVW2S